# Use Case 명세서 (Frontend)

## 행동 주체

- **사용자**: 앱을 사용하는 최종 사용자
- **시스템**: React 앱 (UI 렌더링, 상태 관리, API 호출)
- **Backend API**: Spring Boot 서버

---

## 1. 식단 기록 (Meal Recording)

### UC-004: 음식 검색

**정상 흐름 (UI)**

1. 사용자가 "식단 기록" 탭 클릭
2. **시스템**: 식단 기록 화면 렌더링
   - 검색창 표시
   - "📸 사진으로 추가" 버튼 표시
3. 사용자가 검색창 클릭 및 키워드 입력 (예: "김치찌개")
4. **시스템**: 디바운싱 적용 (300ms 대기)
5. **시스템**: 로딩 인디케이터 표시
6. **시스템**: `GET /api/foods/search?keyword=김치찌개` API 호출
7. **시스템**: 검색 결과 렌더링
   - 음식 카드 리스트 표시
   - 각 카드: 음식명, 칼로리, 탄단지, 1회 제공량
8. 사용자가 원하는 음식 카드 클릭
9. **시스템**: 선택된 음식 데이터를 state에 저장
10. **시스템**: "식단 저장" 화면으로 라우팅

**대안 흐름**

- **4a. 빈 검색어**
  - 검색 결과 초기화
  - 검색창 포커스 유지

- **7a. 검색 결과 없음**
  - "검색 결과가 없습니다" 메시지 표시
  - 일러스트 또는 빈 상태 UI
  - "다른 키워드로 검색해보세요" 안내

- **6a. API 에러 (500, 504)**
  - 에러 토스트 메시지 표시
  - "재시도" 버튼 제공
  - 재시도 시 Step 6으로 복귀

---

### UC-005: 이미지 기반 음식 입력

**정상 흐름 (UI)**

1. 사용자가 "📸 사진으로 추가" 버튼 클릭
2. **시스템**: 바텀 시트 표시
   - "카메라로 촬영"
   - "갤러리에서 선택"
   - "취소"
3. 사용자가 "카메라로 촬영" 선택
4. **시스템**: 카메라 권한 요청 (미승인 시)
5. **시스템**: 카메라 컴포넌트 렌더링
   - 실시간 카메라 프리뷰
   - [촬영] 버튼
   - [취소] 버튼
6. 사용자가 음식 사진 촬영
7. **시스템**: 촬영된 이미지 미리보기
   - 이미지 표시
   - [확인] 버튼
   - [다시 촬영] 버튼
8. 사용자가 [확인] 클릭
9. **시스템**: 로딩 오버레이 표시
   - "음식을 인식하는 중..."
   - 스피너 애니메이션
10. **시스템**: `POST /api/meals/upload/image` API 호출
11. **시스템**: OCR 결과 처리
    - 성공: "✅ 김치찌개 (250g)를 인식했습니다" 토스트
12. **시스템**: "식단 저장" 화면으로 라우팅
    - 음식명: 자동 입력
    - 섭취량: 자동 입력 (OCR 결과)

**대안 흐름 (이미지 분류)**

- **11a. OCR 실패 → 이미지 분류**
  - **신뢰도 ≥80%**:
    - 모달 표시: "이 음식이 맞나요? ✅ 김치찌개 (신뢰도 85%)"
    - 버튼: [다시 촬영] [맞아요]
    - [맞아요] 클릭 → Step 12

  - **70% ≤ 신뢰도 < 80%**:
    - 모달 표시: "이 음식이 맞나요? ⚠️ 김치찌개 (신뢰도 75%)"
    - 다른 후보: "○ 된장찌개 (12%)", "○ 순두부찌개 (3%)"
    - 버튼: [다시 촬영] [맞아요] [다른 음식 선택]
    - [다른 음식 선택] → 후보 목록에서 선택 → Step 12

  - **신뢰도 < 70%**:
    - 모달 표시: "다음 중 맞는 음식을 선택해주세요"
    - 라디오 버튼: ○ 김치찌개 (68%), ○ 된장찌개 (15%), ○ 순두부찌개 (8%)
    - 버튼: [다시 촬영] [직접 검색]
    - [직접 검색] → UC-004 화면으로 이동

**에러 처리**

- **8a. 파일 크기 초과**
  - 에러 모달: "이미지 크기는 5MB 이하여야 합니다"
  - [확인] 버튼 → Step 1로 복귀

- **8b. 지원하지 않는 형식**
  - 에러 모달: "JPEG, PNG, WebP 형식만 지원합니다"
  - [확인] 버튼 → Step 1로 복귀

- **10a. 네트워크 오류**
  - 에러 모달: "이미지 업로드에 실패했습니다"
  - [재시도] [취소] 버튼
  - [재시도] → Step 10

- **11a. 인식 실패**
  - 에러 모달: "음식을 인식할 수 없습니다. 직접 검색해주세요"
  - [직접 검색] 버튼 → UC-004로 이동

---

### UC-006: 식단 저장

**정상 흐름 (UI)**

1. **시스템**: "식단 저장" 화면 렌더링
   - 선택된 음식 정보 표시 (음식명, 기본 제공량, 기본 영양소)
   - 섭취량 입력 필드 (숫자 키패드)
   - 식사 시간대 선택 (버튼 그룹)
   - 날짜 선택 (날짜 피커, 기본값: 오늘)
   - "예상 영양소" 카드 (칼로리, 탄단지)
2. 사용자가 섭취량 입력 (예: 250)
3. **시스템**: 실시간 영양소 재계산
   - `계산된 칼로리 = (250 / 250) × 179 = 179 kcal`
   - "예상 영양소" 카드 업데이트
4. 사용자가 식사 시간대 선택 (예: "점심")
5. **시스템**: 선택된 버튼 하이라이트
6. 사용자가 날짜 선택 (기본값 유지 또는 변경)
7. 사용자가 [저장] 버튼 클릭
8. **시스템**: 입력값 검증
   - 섭취량 > 0
   - 날짜 범위 확인
   - 식사 시간대 선택 확인
9. **시스템**: 로딩 버튼 상태 (스피너)
10. **시스템**: `POST /api/meals` API 호출
11. **시스템**: 성공 응답 처리
    - "저장되었습니다" 토스트 메시지
12. **시스템**: "일간 조회" 화면으로 라우팅

**대안 흐름**

- **8a. 섭취량 미입력 or 0**
  - 섭취량 필드에 빨간색 테두리
  - "섭취량을 입력해주세요" 에러 메시지 표시
  - 포커스 이동

- **8b. 섭취량 범위 초과 (>10,000)**
  - "섭취량은 1~10,000g 사이여야 합니다" 에러 메시지
  - Step 2로 복귀

- **8c. 날짜 유효성 실패**
  - "과거 30일 ~ 오늘까지만 기록 가능합니다" 에러 모달
  - 날짜를 오늘로 초기화

- **10a. API 에러 (400, 404, 500)**
  - 에러 토스트 메시지 표시
  - [재시도] 버튼 제공 또는 로딩 상태 해제

---

### UC-007: 식단 조회

**정상 흐름 (UI)**

1. 사용자가 "일간 조회" 화면 접근 (또는 UC-006 저장 후 자동 이동)
2. **시스템**: 화면 렌더링 (Skeleton UI)
3. **시스템**: 기본값으로 오늘 날짜 설정
4. **시스템**: `GET /api/meals?userId=123&date=2025-01-26` API 호출
5. **시스템**: 응답 데이터 렌더링
   - **헤더**: 날짜 표시 + 좌우 화살표
   - **영양소 요약 카드**:
     - 총 칼로리: 1850 kcal
     - 탄수화물: 220.3g
     - 단백질: 85.5g
     - 지방: 62.7g
   - **목표 대비 달성률** (온보딩 완료 시):
     - 칼로리: 92.5% (프로그레스 바: 파란색)
     - 단백질: 85.5% (프로그레스 바: 파란색)
     - 탄수화물: 88.1% (프로그레스 바: 파란색)
     - 지방: 94.0% (프로그레스 바: 녹색)
   - **시간대별 식단 목록**:
     - "아침" 섹션
       - 음식 카드 1
       - 음식 카드 2
     - "점심" 섹션
       - 음식 카드 1
     - "저녁" 섹션 (빈 상태)
     - "간식" 섹션 (빈 상태)
6. 사용자가 개별 음식 카드 확인

**대안 흐름**

- **5a. 검색 결과 없음 (빈 상태)**
  - 일러스트 또는 빈 상태 아이콘
  - "아직 기록된 식단이 없습니다" 메시지
  - [+ 식단 추가하기] 버튼
  - 클릭 시 → UC-004 화면으로 이동

- **6a. 사용자가 날짜 변경**
  - 좌 화살표 클릭: 전날로 이동
  - 우 화살표 클릭: 다음 날로 이동
  - 날짜 클릭: 캘린더 피커 표시 → 날짜 선택
  - Step 4로 이동 (새 날짜로 API 재호출)

- **6b. 사용자가 음식 카드 [...] 메뉴 클릭**
  - 바텀 시트 표시: [수정하기] [삭제하기] [취소]
  - [수정하기] → UC-008 수정 화면으로 이동
  - [삭제하기] → 확인 모달 → `DELETE /api/meals/{id}` → 리스트에서 제거 + 요약 카드 업데이트

- **6c. Pull-to-Refresh**
  - 사용자가 화면을 아래로 당김
  - 새로고침 인디케이터 표시
  - Step 4로 이동 (API 재호출)

---

## 2. 식단 추천 (Meal Recommendation)

### UC-010: 목표/섭취 기반 식단 추천 조회

**정상 흐름 (UI)**

1. 사용자가 "추천" 탭 클릭
2. **시스템**: 추천 화면 렌더링
   - 식사 시간대 선택 (버튼 그룹: 아침/점심/저녁/간식)
   - 기본값: 현재 시간대 자동 선택
3. 사용자가 식사 시간대 선택 (예: "점심")
4. **시스템**: 로딩 상태 표시 (Skeleton UI)
5. **시스템**: `GET /api/recommendations?userId=123&mealType=lunch` API 호출
6. **시스템**: 응답 데이터 렌더링
   - **현재 상태 요약 카드**:
     - 섭취: 850 kcal
     - 목표: 2000 kcal
     - 도넛 차트: 42.5% 달성
   - **영양소 갭 시각화**:
     - 바 차트:
       - 칼로리: 1150 kcal 부족 (빨간색)
       - 단백질: 64.5g 부족 (빨간색)
       - 탄수화물: 129.7g 부족 (파란색)
       - 지방: 38.0g 부족 (오렌지색)
   - **AI 코칭 메시지**:
     - 💬 "단백질이 64.5g 부족해요. 닭가슴살 샐러드를 추천드려요!"
   - **추천 음식 리스트**:
     - 음식 카드 1 (닭가슴살 샐러드):
       - 음식명
       - 추천 섭취량: 200g
       - 예상 칼로리: 180 kcal
       - 탄단지: 탄 12.3g | 단 28.5g | 지 5.2g
       - 추천 점수: ⭐ 85.5점
       - 추천 사유: #단백질보충 #저칼로리
       - [저장하기] 버튼
       - 👍/👎 피드백 버튼
     - 음식 카드 2
     - ...
7. 사용자가 추천 음식 확인

**대안 흐름**

- **5a. 온보딩 미완료 (409 에러)**
  - 모달 표시: "목표 설정이 필요합니다"
  - [온보딩 시작하기] 버튼 → 온보딩 플로우로 이동

- **5b. 섭취 기록 없음**
  - 기본 균형 추천 모드
  - 메시지: "오늘은 아직 기록이 없어요. 균형 잡힌 식단을 추천드릴게요!"

- **7a. 사용자가 [저장하기] 클릭**
  - UC-011로 이동 (추천 항목 저장)

- **7b. 사용자가 👍/👎 클릭**
  - UC-013으로 이동 (피드백 제출)

---

### UC-011: 추천 항목 선택 → 식단 저장

**정상 흐름 (UI)**

1. 사용자가 추천 음식 카드의 [저장하기] 클릭
2. **시스템**: "식단 저장" 화면으로 라우팅
   - 음식 정보: 자동 입력 (추천 받은 음식)
   - 섭취량: 추천 섭취량으로 기본값 설정
   - 식사 시간대: 추천 받은 시간대로 기본값 설정
   - 날짜: 오늘
3. 사용자가 섭취량 조정 (선택적)
4. 사용자가 [저장] 클릭
5. **시스템**: UC-006과 동일한 저장 프로세스
6. **시스템**: 추가로 `POST /api/recommendations/events` API 호출
   - eventType: "save"
   - setId, foodId 포함
7. **시스템**: 성공 토스트 + 일간 조회 화면으로 이동

---

### UC-012: 추천 필터/제약 설정

**정상 흐름 (UI)**

1. 사용자가 "마이페이지" → "추천 설정" 메뉴 클릭
2. **시스템**: 추천 설정 화면 렌더링
3. **시스템**: `GET /api/recommendations/settings?userId=123` API 호출
4. **시스템**: 기존 설정 표시 (있는 경우)
   - 알레르기: ["땅콩", "우유"]
   - 비선호 음식: ["김치"]
   - 선호 음식: ["닭고기", "샐러드"]
5. 사용자가 설정 수정
   - 알레르기 음식 추가/제거 (태그 입력)
   - 비선호 음식 추가/제거
   - 선호 음식 추가/제거
6. 사용자가 [저장] 버튼 클릭
7. **시스템**: `POST /api/recommendations/settings` API 호출
8. **시스템**: "설정이 저장되었습니다" 토스트
9. **시스템**: 이전 화면으로 복귀

---

### UC-013: 추천 피드백 수집 및 반영

**정상 흐름 (UI)**

1. 사용자가 추천 음식 카드의 👍 또는 👎 버튼 클릭
2. **시스템**: 버튼 상태 변경 (활성화 표시)
3. **시스템**: `POST /api/recommendations/feedback` API 호출
   - feedbackType: "like" 또는 "dislike"
4. **시스템**: "피드백 감사합니다!" 토스트 메시지 (짧게)
5. **시스템**: 다음 추천 시 피드백 반영

---

## 3. 온보딩 (Onboarding)

### UC-001: 온보딩 플로우

**정상 흐름 (UI)**

1. 사용자가 앱 최초 실행 또는 "온보딩 시작" 버튼 클릭
2. **시스템**: 온보딩 Step 1 화면 렌더링
   - 제목: "NutriAgent에 오신 것을 환영합니다!"
   - 설명: "건강한 식단 관리를 시작해보세요"
   - 일러스트
   - [시작하기] 버튼
3. 사용자가 [시작하기] 클릭
4. **시스템**: 온보딩 Step 2 화면 (TDEE 계산)
   - 진행률 표시: Step 1/3
   - 입력 필드:
     - 성별 선택 (라디오: 남/여)
     - 나이 (숫자 입력)
     - 체중 (숫자 입력, kg)
     - 신장 (숫자 입력, cm)
     - 활동량 (드롭다운 또는 라디오)
   - 실시간 TDEE 계산 결과 표시
   - [다음] 버튼
5. 사용자가 정보 입력 및 [다음] 클릭
6. **시스템**: 온보딩 Step 3 화면 (목표 설정)
   - 진행률 표시: Step 2/3
   - 목표 칼로리 (TDEE 기반 추천값, 수정 가능)
   - 영양소 비율 설정:
     - 탄수화물 슬라이더 (40-60%)
     - 단백질 슬라이더 (20-40%)
     - 지방 슬라이더 (20-40%)
     - 합계 100% 유지 (자동 조정)
   - 실시간 목표 영양소 그램 표시
   - [완료] 버튼
7. 사용자가 목표 설정 및 [완료] 클릭
8. **시스템**: `POST /api/onboarding` API 호출
9. **시스템**: 성공 응답 처리
   - "설정이 완료되었습니다!" 토스트
10. **시스템**: 메인 화면 (홈 또는 일간 조회)으로 라우팅

**대안 흐름**

- **5a. 입력값 검증 실패**
  - 빈 필드: "필수 값을 입력해주세요" 에러 메시지
  - 범위 초과: "올바른 값을 입력해주세요"

- **8a. API 에러 (409 - 이미 완료)**
  - "이미 온보딩이 완료되었습니다" 모달
  - [확인] → 메인 화면으로 이동

---

## 참고 사항

### 공통 UI 패턴

**로딩 상태**
- 초기 로딩: Skeleton UI
- 액션 로딩: 버튼 내 스피너
- 전체 화면 로딩: 오버레이 + 스피너

**에러 처리**
- 네트워크 에러: 토스트 + 재시도 버튼
- 검증 에러: 필드 하이라이트 + 인라인 메시지
- 서버 에러: 모달 또는 토스트

**빈 상태**
- 일러스트 + 메시지 + 액션 버튼
- 긍정적인 톤 사용

**성공 피드백**
- 토스트 메시지 (2-3초)
- 체크 애니메이션
- 햅틱 피드백 (모바일)
